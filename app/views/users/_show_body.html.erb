<div class="row-fluid">
  <div class="span4">
    <div class="default-padding">

      <div class="subblock bordered">
        <div class="default-padding">
          <h2>
            <%= @user.first_name %> <%= @user.last_name %>
          </h2>

          <p>
            <%= mail_to @user.email, @user.email, :encode => "hex" if !@user.email.empty? %>
          </p>

          <% if @user.is_admin? %>
              <p><b><i class="icon-user-admin-blk tooltip-basic" data-tooltip-text="<%= t(:system_wide_admin) %>"></i> <%= t(:admin) %></b></p>
          <% end %>

          <% if user_signed_in? and current_user == @user %>
              <p style="margin-bottom: 0px;"><b><%= t(:you) %></b></p>
              <p><%= link_to t(:edit_settings), edit_user_path, :class => "btn primary" %></p>
              <p><%= link_to t(:change_password), edit_user_registration_path, :class => "btn primary" %></p>
              <p><%= link_to t(:delete_account), registration_path(@user), :data => { :confirm => "Are you sure?"}, :method => :delete, :class => "btn danger" %></p>
          <% end %>
        </div>
      </div>

      <div class="subblock">
        <h2><%= user_title @user, t(:groups) %></h2>
        <% if !@memberships.empty? %>

            <table>
              <tr>
                <th><%= t(:name) %></th>
                <% if @memberships.any? {|m| can? :edit, m} %><th><%= t(:roles) %></th><% end %>
              </tr>

              <% @memberships.each do |membership| %>
                  <tr>
                    <td>
                      <!-- TODO show leader icon if @user is a leader of the group that is listed here <%# if current_user.is_admin? %>
                <i class="icon-user-leader-blk tooltip-basic" data-tooltip-text="This user is a leader of this group"></i>
              <%# end %>
              -->
                      <%= link_to membership.group.name, membership.group %>
                    </td>
                    <% if can? :edit, membership %>
                        <td>
                          <%= form_for([membership.group, membership]) do |f| %>
                              <% if can? :update, membership.group %>
                                <%= f.select :level, Membership::LEVELS, { }, :style => "width: 80px;" %>
                              <% else %>
                                 <%= membership.level_name.humanize %>
                              <% end %>
                              <%= f.select :receive_emails, {"Receive Emails" => true, "Don't Receive Emails" => false}%>
                              <div class="submit_bar sub_actions">
                                <%= f.submit :class => "btn primary" %>
                              </div>
                          <% end %>
                        </td>
                   <% end %>
                  </tr>
              <% end %>
            </table>

            <br/><br/>
        <% end %>

      </div>

    </div>
  </div>

  <div class="span4">
    <div class="default-padding">

      <div class="subblock">

        <h2><%= user_title @user, t(:screens) %></h2>

        <ul class="list-grid">

          <% @screens.each do |screen| %>
              <li>
                <div class="cont thumb-icon">
                  <%= link_to screen do %>
                      <i class="icon-controller-screens"></i>
                  <% end %>
                </div>
                <div class="cont">
                  <p><b><%= link_to screen.name, screen %></b></p>
                  <% if screen.owner.is_a? Group %>
                    <p><%= link_to screen.owner.name, screen.owner %></p>
                  <% end %>
                </div>
              </li>
            <% end %>

        </ul>


      </div>

    </div>
  </div>

  <div class="span4">
    <div class="default-padding">

      <div class="subblock">
        <h2><%= user_title @user.first_name, t(:contents) %></h2>

        <% if !@contents.empty? %>
            <ul class="list-grid">
              <% @contents.each do |content| %>
                  <li>
                    <div class="cont thumb-icon">
                      <%= link_to content do %>
                          <%= render_content(content, {:type => 'grid'}) %>
                      <% end %>
                      <% if content.is_orphan? %>
                        <p class="is_orphan">Orphaned</p>
                      <% elsif content.is_approved? %>
                        <p class="is_approved">Approved</p>
                      <% else %>
                        <% if content.is_pending? %>
                          <span class="is_pending">Pending</span>
                        <% end %>
                        <% if content.is_denied? %>
                          <% if content.is_pending? %>
                            <br>
                          <% end %>
                          <span class="is_denied">Denied</span>
                        <% end %>
                      <% end %>
                    </div>
                    <div class="cont">
                      <p>
                        <b><%= link_to content.name, content %></b>
                      </p>
                      <p><%= content.type %></p>
                      <p>
                        <%= content.start_time.nil? ? '-' : content.start_time.strftime("%m/%d") %> to <%= content.end_time.nil? ? 'Forever' : content.end_time.strftime("%m/%d") %>
                      </p>
                    </div>
                  </li>
              <% end %>
            </ul>

        <% else %>

        <% end %>

      </div>

    </div>
  </div>
</div>
